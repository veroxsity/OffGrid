---
title: "WireGuard VPN Server on Ubuntu 22.04"
description: "Set up your own WireGuard VPN server for secure remote access. Includes UK-specific port forwarding and firewall configuration."
category: "VPN & Tunnels"
difficulty: "Intermediate"
time: "45 minutes"
ukSpecific: true
tags: ["wireguard", "vpn", "ubuntu", "security", "remote-access", "port-forwarding", "uk-router"]
author: "Off-Grid Freedom"
lastUpdated: "2024-01-15"
testedOn: ["Ubuntu 22.04", "Ubuntu 20.04"]
prerequisites: 
  - "Ubuntu 22.04 server with root access"
  - "Public IP address or UK ISP router"
  - "Basic Linux command line knowledge"
securityLevel: "High"
---

# WireGuard VPN Server on Ubuntu 22.04

> TL;DR: Install WireGuard, generate server and client keys, configure wg0 with a private subnet (10.8.0.0/24), forward UDP 51820 on your router, enable IP forwarding, open the firewall, then verify peers connect and traffic egresses via the server.

## Before you begin
- Ensure the server is up to date and you have sudo
- Decide on the VPN subnet (e.g., 10.8.0.0/24) and UDP port (default 51820)
- If on a UK ISP router, confirm you can forward UDP 51820 to this server

## Security model and defaults
- WireGuard uses modern cryptography with pre-shared public keys; no passwords over the tunnel
- Expose only UDP 51820 on the server’s firewall; default-deny all else
- Do not run other admin services on the public interface without TLS and hardening

## Why WireGuard?

- **Actually secure**: Modern cryptography, minimal codebase
- **Fast**: Outperforms OpenVPN significantly
- **Simple**: Easier to configure than IPSec nightmares
- **Your data**: No third-party logging

## UK Router Compatibility

✅ **Tested with UK ISPs:**
- BT Smart Hub 2 (Sky Fibre)
- Virgin Media Hub 4/5
- TalkTalk WiFi Hub
- Plusnet Hub One

## Step 1: Server Preparation

Update your system:

```bash
sudo apt update && sudo apt upgrade -y
sudo reboot
```

Install WireGuard:

```bash
sudo apt install wireguard wireguard-tools -y
```

## Step 2: Generate Server Keys

```bash
cd /etc/wireguard
sudo umask 077

# Generate server private key
sudo wg genkey | sudo tee server_private.key

# Generate server public key
sudo cat server_private.key | wg pubkey | sudo tee server_public.key
```

## Step 3: Server Configuration

Create the server config:

```bash
sudo nano /etc/wireguard/wg0.conf
```

Add this configuration:

```ini
[Interface]
# Server private key
PrivateKey = [PASTE_SERVER_PRIVATE_KEY_HERE]

# Server IP range (change if conflicts with your network)
Address = 10.8.0.1/24

# Server port (change if needed)
ListenPort = 51820

# IP forwarding
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

# Client configurations will be added here
```

**⚠️ Security Note:** Replace `[PASTE_SERVER_PRIVATE_KEY_HERE]` with your actual server private key from step 2.

## Step 4: Enable IP Forwarding

```bash
echo 'net.ipv4.ip_forward=1' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

## Step 5: UK Router Port Forwarding

### BT Smart Hub 2
1. Go to `192.168.1.254` → Advanced → Firewall
2. Add Port Forwarding Rule:
   - External Port: `51820`
   - Internal Port: `51820`
   - Protocol: `UDP`
   - Internal IP: Your server's local IP

### Virgin Media Hub 4/5
1. Go to `192.168.0.1` → Advanced → Port Forwarding
2. Create Custom Service:
   - Name: `WireGuard`
   - Protocol: `UDP`
   - External Port: `51820`
   - Internal Port: `51820`
   - Server IP: Your server's IP

### TalkTalk WiFi Hub
1. Go to `192.168.1.1` → Firewall → Port Forwarding
2. Add Service:
   - Service Name: `WireGuard`
   - Protocol: `UDP`
   - External Port: `51820-51820`
   - Internal IP: Your server
   - Internal Port: `51820-51820`

## Step 6: Configure Firewall

```bash
# Allow WireGuard port
sudo ufw allow 51820/udp

# Allow SSH (don't lock yourself out!)
sudo ufw allow ssh

# Enable firewall
sudo ufw enable
```

## Step 7: Generate Client Configuration

For each client device:

```bash
# Generate client keys
cd /etc/wireguard
sudo wg genkey | sudo tee client1_private.key
sudo cat client1_private.key | wg pubkey | sudo tee client1_public.key
```

Add client to server config:

```bash
sudo nano /etc/wireguard/wg0.conf
```

Append to the file:

```ini
[Peer]
# Client public key
PublicKey = [CLIENT_PUBLIC_KEY]
# Client IP
AllowedIPs = 10.8.0.2/32
```

## Step 8: Client Configuration File

Create `client1.conf`:

```ini
[Interface]
PrivateKey = [CLIENT_PRIVATE_KEY]
Address = 10.8.0.2/32
DNS = 1.1.1.1, 1.0.0.1

[Peer]
PublicKey = [SERVER_PUBLIC_KEY]
Endpoint = [YOUR_PUBLIC_IP]:51820
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 25
```

**Replace:**
- `[CLIENT_PRIVATE_KEY]` with client private key
- `[SERVER_PUBLIC_KEY]` with server public key  
- `[YOUR_PUBLIC_IP]` with your public IP

## Step 9: Start WireGuard

```bash
# Enable and start WireGuard
sudo systemctl enable wg-quick@wg0
sudo systemctl start wg-quick@wg0

# Check status
sudo systemctl status wg-quick@wg0
sudo wg show
```

## Verify the deployment

- Check the interface and listening port on the server

```bash
sudo wg show
sudo ss -u -lpn | grep 51820 || sudo netstat -u -lpn | grep 51820
```

What this does: Confirms the wg0 interface is up and WireGuard is listening on UDP 51820.

- From a client network (outside), verify the port is reachable

```bash
nmap -sU -p 51820 YOUR.PUBLIC.IP
```

Expected: Port 51820/udp shows open|filtered (many routers report this), which is acceptable. A full test is to connect a client and run traffic.

## Backups

- Back up `/etc/wireguard/wg0.conf` and private/public keys under `/etc/wireguard/`

```bash
sudo tar -czf ~/wg-backup-$(date +%F).tgz -C /etc wireguard
```

## Uninstall / rollback

```bash
sudo systemctl disable --now wg-quick@wg0
sudo apt -y purge wireguard wireguard-tools
sudo rm -f /etc/wireguard/wg0.conf /etc/wireguard/*_private.key /etc/wireguard/*_public.key
```

## References
- WireGuard docs: https://www.wireguard.com/
- wg-quick man page: https://manpages.debian.org/wg-quick
- UK Port Forwarding: ../networking/uk-port-forwarding

---

**You now have your own private VPN server.** No more trusting commercial VPN providers with your data. Your traffic routes through your server, under your control.

Configure additional clients by repeating the client setup process with unique keys and IP addresses.

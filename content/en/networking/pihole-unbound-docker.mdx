---
title: "Pi-hole + Unbound (Recursive DNS) with Docker"
description: "Run Pi-hole with a local validating, recursive resolver (Unbound) using Docker Compose."
category: "Networking"
difficulty: "Intermediate"
time: "35 minutes"
ukSpecific: false
status: "published"
tags: ["pihole","unbound","dns","docker","ad-blocking"]
author: "Off-Grid Freedom"
lastUpdated: "2025-08-13"
testedOn: ["Ubuntu 24.04", "Ubuntu 22.04", "Debian 12"]
prerequisites:
  - "Docker + Compose installed"
  - "Ports 53 and 80 available"
---

# Pi-hole + Unbound (Recursive DNS) with Docker

Local, private DNS with built-in ad/tracker blocking and no third-party resolvers.

> TL;DR: Bring up Pi-hole + Unbound with Compose, point Pi-hole upstream to 127.0.0.1#5335, set your LAN to use Pi-hole for DNS, verify with dig, and keep port 53 LAN-only.

## Before you begin
- Docker + Compose installed; host updated
- Confirm ports 53 (TCP/UDP) and 80 are free on this host
- Decide whether DHCP will hand out your DNS (router config) or per-device

```bash
sudo apt update && sudo apt -y install ca-certificates curl jq dnsutils
```

What this does: Installs tools used for DNS verification.

## Security model and defaults
- Keep DNS LAN-only; never expose port 53 to the internet
- Password-protect the Pi-hole admin; restrict UI by firewall if needed
- Use Unbound for privacy (no third-party upstreams); enable DNSSEC

## 1) Create project

```bash
mkdir -p ~/pihole-unbound && cd ~/pihole-unbound
mkdir etc-dnsmasq.d etc-pihole
```

## 2) docker-compose.yaml

```yaml
services:
  pihole:
    image: pihole/pihole:latest
    container_name: pihole
    hostname: pihole
    environment:
      TZ: "Europe/London"
      WEBPASSWORD: "change-me"
      FTLCONF_reply_addr4: "0.0.0.0"
    volumes:
      - ./etc-pihole:/etc/pihole
      - ./etc-dnsmasq.d:/etc/dnsmasq.d
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "80:80/tcp"
    depends_on:
      - unbound
    restart: unless-stopped

  unbound:
    image: mvance/unbound:latest
    container_name: unbound
    hostname: unbound
    restart: unless-stopped
```

Bring it up:

```bash
docker compose up -d
```

What this does: Starts Pi-hole (web UI on 80) and Unbound (recursive resolver), with port 53 exposed for LAN DNS.

## 3) Point Pi-hole to Unbound

- Visit the admin UI: `http://SERVER_IP/admin` (password from `WEBPASSWORD`).
- Settings → DNS → Upstream DNS Servers → Custom 1 (IPv4): `127.0.0.1#5335` (the mvance image listens on 5335).
- Disable all public upstreams.

Also enable DNSSEC in Pi-hole (Settings → DNS → DNSSEC) for validation.

## 4) Optional: Conditional forwarding

Settings → DNS → Conditional Forwarding:
- Local network: e.g., `192.168.1.0/24`
- Gateway: your router IP, e.g., `192.168.1.1`
- Local domain: e.g., `lan`

## 5) Make Pi-hole your network DNS

- Preferred: set router DHCP DNS to your server’s IP (clients inherit automatically).
- Per-device: set DNS to your server’s IP.

## 6) Verify

```bash
dig @SERVER_IP offgrid.freedom +short
# Should resolve quickly

dig @SERVER_IP google.com +short

# DNSSEC validation example
dig @SERVER_IP dnssec-failed.org +dnssec +multi
```

Expected: Normal domains resolve; `dnssec-failed.org` should indicate validation failures are caught by DNSSEC.

Check logs/UI:
- Pi-hole Query Log shows requests and blocks
- `docker compose logs -f unbound` for recursion activity

## Backups

- Backup `./etc-pihole` and `./etc-dnsmasq.d`

```bash
sudo tar -czf /backups/pihole-$(date +%F).tgz ./etc-pihole ./etc-dnsmasq.d
```

Restore example:

```bash
# Stop stack
docker compose down
# Restore config
sudo tar -xzf /backups/pihole-YYYY-MM-DD.tgz -C .
# Start
docker compose up -d
```

## Troubleshooting

- Clients still using ISP DNS
  - Ensure router DHCP hands out your server IP as DNS; renew leases.
- Admin UI not loading
  - Check port 80 conflicts; verify container is healthy.
- Queries time out
  - Unbound not reachable or blocked; verify Pi-hole upstream set to 127.0.0.1#5335 and container depends_on.

## Security hardening checklist
- Restrict port 53 and 80 to LAN via firewall
- Use long, unique admin password; disable admin from WAN
- Keep blocklists curated; avoid malicious list sources

## Uninstall / rollback

```bash
docker compose down
# Optional: remove persisted data (ensure backups)
sudo rm -rf ./etc-pihole ./etc-dnsmasq.d
```

## FAQ
- Q: Do I need DNS-over-HTTPS/DoT if using Unbound?
  - A: No. Unbound does recursion directly to root servers with validation; DoH/DoT aren’t necessary for privacy here.
- Q: Can Pi-hole also do DHCP?
  - A: Yes, Pi-hole can serve DHCP; disable your router’s DHCP first.

## References
- Pi-hole Docs: https://docs.pi-hole.net/
- Unbound Docs: https://nlnetlabs.nl/documentation/unbound/
